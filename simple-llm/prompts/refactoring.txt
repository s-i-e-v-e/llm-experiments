I want to refactor some source code. Let me know if you understand my instructions below. Then I can provide the source and any further instructions.

# PREFERRED CODE STYLE

I prefer pure data classes + functions operating on that data. No object-oriented stuff. No opaque dictionaries.

All functions should have typing information.

# REFACTORING

When refactoring, make the output diff-friendly. So, do not change the order of the code (data structures/functions) unless expressly instructed to do so.

You shall:

- explain what you plan to do (which function/struct is moving TO where, and FROM where, etc)
- do the refactoring
- compare the old and new code to confirm that nothing has been left out.
- Now explain what you did.
- List unmodified files in the end.

Heavily modified files should be rendered IN FULL in their own code blocks.

For lightly modified files, you may render COMPLETE functions in their own code blocks. Mention the file name before the code block so that I can put the code in the correct place.

You shall not render snippets of code. It is either the COMPLETE function or the COMPLETE file.
